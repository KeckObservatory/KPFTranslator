<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Josh Walawender" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Observing Procedures - KPF</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Observing Procedures";
        var mkdocs_page_input_path = "observingprocedures.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> KPF
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">KPF Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../status/">Instrument Status</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Instrument Info</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Instrument Subsystems</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../spectrograph/">Spectrograph</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../fiu/">FIU</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../tiptilt/">Tip Tilt Sysyem</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../guider/">Guider</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../cahk/">Ca H&K Spectrograph</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../exposuremeter/">Exposure Meter</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../calbench/">Calibration Bench</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../socal/">Solar Calibrator</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../agitator/">Agitator</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../computers/">Computers</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Instrument Specifications</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../detectors/">Detectors</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sensitivity/">Sensitivity</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../dataflow/">Data Flow</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../KPFvsHIRES/">KPF vs. HIRES</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fastreadmode/">Fast Read Mode</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Observing with KPF</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../communitycadence/">Community Cadence (KPF-CC)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../afternoonsetup/">Afternoon Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../calibrations/">Daytime Calibrations</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Observing Procedures</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nighttimecalibrations/">Nighttime Calibrations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../expmetertermination/">Exposure Meter Termination</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Observing Blocks</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../buildingOBs/">Building OBs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../SciOBparameters/">Science OB Parameters</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../CalOBparameters/">Calibration OB Parameters</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://koa.ipac.caltech.edu/rti-gui/login">Retrieving Data in Real Time</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../kpfdrp/">Data Reduction</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">General Observing Info</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Weather</a>
    <ul>
                <li class="toctree-l2"><a class="" href="http://mkwc.ifa.hawaii.edu/forecast/mko/index.cgi">MK Weather Center</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www3.keck.hawaii.edu/skycams/CloudCamTimelapse.html">Keck Cloud Cameras</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Useful Keck Pages</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://www2.keck.hawaii.edu/observing/keckSchedule/keckSchedule.php">Telescope Schedule</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.keck.hawaii.edu/realpublic/inst/common/starlist.html">Target List Format</a>
                </li>
                <li class="toctree-l2"><a class="" href="http://www2.keck.hawaii.edu/inst/">Keck Instruments</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www3.keck.hawaii.edu/login/">Observer Login Page</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www2.keck.hawaii.edu/software/obsplan/obsplan.php">Planning Tool</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://ucolick.org/calendar/keckcal2021-30/index.html">Twilight, Moon rise, etc.</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www2.keck.hawaii.edu/inst/common/offset.php">Offset & PA Calculator</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.keckobservatory.org/observing/">General Keck Observing Info</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.keck.hawaii.edu/realpublic/inst/kpf/pre-observing_checklist.html">Pre-observing Checklist</a>
                </li>
                <li class="toctree-l2"><a class="" href="http://www2.keck.hawaii.edu/inst/common/mainland_observing.html">Remote Observing</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www2.keck.hawaii.edu/inst/common/TelLimits.html">Telescope Limits</a>
                </li>
                <li class="toctree-l2"><a class="" href="http://www2.keck.hawaii.edu/observing/kecktelgde/ktelinstupdate.pdf">Telescope Info</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Keck Policies</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://www2.keck.hawaii.edu/inst/common/too_policies.html">ToO Interrupts</a>
                </li>
                <li class="toctree-l2"><a class="" href="http://www2.keck.hawaii.edu/observing/SplitNights.html">Split Nights</a>
                </li>
                <li class="toctree-l2"><a class="" href="http://www2.keck.hawaii.edu/inst/common/mainland_observing.html">Remote Observing</a>
                </li>
                <li class="toctree-l2"><a class="" href="http://www2.keck.hawaii.edu/observing/policies.html">Other Policies</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">After Your Observing Run</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://www2.keck.hawaii.edu/inst/PILogin/login.php">Post-observing Comment Form</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Retrieve Your Data</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://koa.ipac.caltech.edu/">Retrieve Data from KOA</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://koa.ipac.caltech.edu/UserGuide/PyKOA/TAPClients.html#pykoa">Retrieve Data using PyKOA</a>
                </li>
                <li class="toctree-l2"><a class="" href="http://www2.keck.hawaii.edu/realpublic/koa/public/KOA_data_policy.pdf">Data Proprietary Period</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://www2.keck.hawaii.edu/observing/keck_authors.html">Acknowledging Keck</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../references/">Acknowledging KPF</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Technical Documentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../KPFTranslator/">Instrument Software</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scripts/scripts/">Operations Scripts</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://keckobservatory.atlassian.net/wiki/external/Yzg1NGM2NzVkMjUwNGRmMGE4ODBiNThiNWY1YzViY2U">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tiptiltinstructions/">Tip Tilt Instructions for OAs</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">KPF</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Observing with KPF</li>
      <li class="breadcrumb-item active">Observing Procedures</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="quick-reference">Quick Reference</h1>
<ul>
<li><a href="#beginning-of-the-night">Beginning of the Night</a></li>
<li><a href="#performing-observations">Performing Observations</a></li>
<li><a href="#switching-programs-on-a-split-night">Switching Programs on a Split Night</a></li>
<li><a href="#bad-weather">Bad Weather</a></li>
</ul>
<h1 id="beginning-of-the-night">Beginning of the Night</h1>
<h3 id="wait-for-dome-to-open">Wait for Dome to Open</h3>
<p>The Observing Assistant (OA) is not permitted to open the dome until after sunset. Please be patient while the shutter opens and the OA checks the initial telescope pointing. </p>
<h3 id="run-start-of-night">Run Start of Night</h3>
<p>KPF needs to be configured properly at the start of the night. There is a procedure which should be run <strong>only after the Observing Assistant (OA) has selected KPF as the instrument</strong> and <strong>after automated afternoon calibrations are complete.</strong>  The selected instrument ("INST") can be seen in the lower left corner of the <a href="../figures/FACSUM.png">FACSUM window</a>.</p>
<p>It is important that this not be run while other instruments are observing. To configure KPF for observing, run <code>KPF Control Menu --&gt; Run Start of Night Script</code> from the background menu (or <code>kpfStartOfNight</code> from the command line on any KPF machine). This will:</p>
<ul>
<li>Disable automated calibrations</li>
<li>Configure the FIU to the observing mode</li>
<li>Open the science and sky source select shutters</li>
<li>Configure the AO Bench. Including positioning the PCU stage and opening the AO hatch.</li>
<li>Configure DCS for KPF by setting dcs.ROTDEST=0 and dcs.ROTMODE=stationary</li>
<li>Configure the tip tilt loop gain to its default setting</li>
<li>Set data output directory</li>
<li>Set observers from telescope schedule</li>
</ul>
<h3 id="slew-to-the-vicinity-of-your-first-target">Slew to the Vicinity of Your First Target</h3>
<p>When ready to move the telescope, the OA will ask you for your first target and load the coordinates from your starlist file. They will select a bright star near your target and will attempt to acquire that in the guider, then will double-check the accuracy of pointing by acquiring one or two additional stars from the SAO or GSC catalogs.</p>
<p>To monitor the guider images, run <code>Telescope GUIs --&gt; MAGIQ Guider UI</code> from the background menu.</p>
<h3 id="focus-the-telescope">Focus the Telescope</h3>
<p>The OA will run the telescope focus procedure (typically Autofoc) near your science field. On some nights, they will opt for the Mira focus procedure which takes slightly longer but is needed to calibrate the secondary mirror tilt.</p>
<h1 id="performing-observations">Performing Observations</h1>
<h3 id="highlight-your-target-in-magiq">Highlight Your Target in Magiq</h3>
<p>In the Magiq star list (at the bottom of the Magiq User GUI), right click your target and select the option to highlight it for the OA (you can get the same result by middle clicking the target).  This highlighting will show up on the OA's GUI making it easier for them to find the target you want to go to.  Let the OA know to slew to the target when your current exposure is done.</p>
<h3 id="execute-your-ob">Execute Your OB</h3>
<p>Observers can load previously saved OBs or create them on the fly for KPF observing. To load and execute a saved OB:</p>
<ul>
<li>Click Load OB from File</li>
<li>Select the OB from the file list</li>
<li>Click Execute This OB (or Execute OB with Slew Cal)</li>
</ul>
<p>The GUI will first prompt the observers to confirm the OB execution. Once confirmed, an xterm will launch and prompt the observers with addtional information if and when needed, so watch the contents of this xterm.</p>
<p>Executing the OB will not start an exposure immediately. The system will first configure the instrument and will then prompt the observer to confirm once the OA has acquired the target. While configuring the instrument, the OB will provide information on how to set the gain and frames per second on the guider.  Because of this, <strong>it is important to execute the OB during the slew</strong> and before the OA acquires the target, so they have the right exposure parameters to see the target on the guider.</p>
<p>The log lines which show up in the xterm with the running OB contain useful information.  In general, lines with INFO are attempting to explain what the instrument is doing.  Lines with WARNING are indicating that a minor problem has occurred, but the system is handling it -- these lines are purely informational, no action is needed on the part of the observer in response.  Lines with ERROR indicate a serious problems which may require user intervention.</p>
<h3 id="slew-cals">Slew Cals</h3>
<p>KPF has the option of taking a "slew cal" immediately prior to a science observation.  This is a way to make use of the time spent slewing from one target to another.  If an OB is executed with a slew cal (using the "Execute OB with Slew Cal" button in the OB GUI), then the FIU will transition to calibration mode (the FIU hatch will close and calibration light will be directed to the science and sky fibers), and a calibration exposure will be taken.  This will obscure the sky during calibration, so the OA will not be able to see the target until the slew cal is done.  This process takes around 2 minutes and so fits nicely in to long slews.</p>
<p>An alternative to a slew cal is a simultaneous calibration (simulcal).  To use this enable the <code>TakeSimulCal</code> option in the OB or on the OB GUI and either manually set the ND filters to apply to the calibration light or enable the <code>AutoNDFilters</code> option.  See the <a href="../nighttimecalibrations/">nighttime calibrations</a> page for more info on both the slew cal and simulcal options.</p>
<h3 id="stopping-scripts-or-exposures">Stopping Scripts or Exposures</h3>
<p><strong>Important</strong>: If you wish to halt an OB during execution, do <strong>NOT</strong> hit Control-c in the terminal.  Use the "Request Script STOP" button instead. The KPF scripts have checkpoints in them which are places where the script can cleanly exit and perform important cleanup operations.  The "STOP Exposure and Script" button does the same thing, but it will also terminate an exposure in progress.</p>
<h3 id="known-issues">Known Issues</h3>
<p>There is a known failure mode for KPF called a "start state error".  What happens is some sort of communication failure between the <code>kpfexpose</code> control software, the galil hardware which handles the timing and signaling of the detectors and shutters, and the Archon detector controllers.  The result is that one of the green or red detectors does not begin the exposure properly and that detector's data will be useless.  The <code>kpf.spectrograph.StartExposure</code> <a href="../scripts/StartExposure/">script</a> will automatically detect this situation, terminate the bad exposure after a few seconds, and start a new one all without user intervention.  This will generate several WARNING level log messages, but the user does not need to take action as the correction happens automatically.</p>
<p>Another known failure mode which can generate WARNING level log messages is a failure of the FIU to transition in to a new mode (i.e. "Observing" or "Calibration").  The <code>kpf.fiu.ConfigureFIU</code> and <code>kpf.fiu.WaitForConfigureFIU</code> <a href="../scripts/WaitForConfigureFIU/">scripts</a> will automatically retry several times before giving up and erroring out.  As with the start state error above, no user action is needed, but you will see WARNING level log messages to let you know what is happening.</p>
<h1 id="switching-programs-on-a-split-night">Switching Programs on a Split Night</h1>
<p>On a KPF/KPF split night, before starting the second KPF program, run <code>KPF Control Menu --&gt; Set Program ID and Observers</code> from the background menu (or <code>kpfSetObserverFromSchedule</code> from the command line on any KPF machine). Enter the program ID at the terminal prompt. The script will then set program ID and observers for the second KPF program, based on the telescope schedule.</p>
<p>If you wish to set the observer names and program ID manually (i.e. without querying the telescope schedule), you can use the <code>kpfSetProgram</code> and <code>kpfSetObserver</code> scripts from the command line.  For example: <code>kpfSetProgram K123</code> will set program ID "K123" and <code>kpfSetObserver "E.E. Barnard, S.W. Burnham"</code> will set the observer name to "E.E. Barnard, S.W. Burnham".  Note that observer names should be enclosed in quotes to handle spaces in the list of names.</p>
<h1 id="bad-weather">Bad Weather</h1>
<p>If the weather is so bad that no observing is taking place and there doesn't seem to be an immediate likelihood of observing, then we recommend that the observer runs the end of night procedure (<code>KPF Control Menu --&gt; Run End of Night Script</code>).  The main advantage of this is that running End of Night will re-enable the automatic scheduled calibrations which happen 4 times per night when KPF is not on sky.  This means that the instrumental drift will be tracked with no action required by the observer (i.e. running slew cals).  If one of these calibration scripts is in progress and observing should resume, use the "Request Script STOP" as described above. After that, run the Start of Night script just as you would at the beginning of the night (among other things it disables the autmatic scheduled calibrations).</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../calibrations/" class="btn btn-neutral float-left" title="Daytime Calibrations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../nighttimecalibrations/" class="btn btn-neutral float-right" title="Nighttime Calibrations">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/KeckObservatory/KPFTranslator/" class="fa fa-code-fork" style="color: #fcfcfc"> KPFTranslator</a>
        </span>
    
    
      <span><a href="../calibrations/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../nighttimecalibrations/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
